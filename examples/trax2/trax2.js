!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function t(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function e(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var n="ΔTrackable",r="ΔChangeVersion",i="ΔFactory",o="ΔDefFactories",a="ΔIsFactory",s="ΔΔProxy",u="ΔIsProxy",c="ΔCreateProxy",f="ΔnewItem",d="Δdispose",v="Δjson",l=!1;function h(t){return t&&t.ΔTrackable?t.ΔMd?t.ΔMd:t.ΔMd={parents:void 0,refreshCtxt:void 0,watchers:void 0}:null}var p=Array.isArray;function m(t,e){t&&(p(t)&&!t[u]?t.forEach(e):e(t))}function y(t,e){if(t&&e){if(t===e)return;if(p(t)){var n=t;if(1===n.length){if(n[0]===e)return}else{var r=n.indexOf(e);if(r>-1)return n.splice(r,1),1===n.length?n[0]:n}}}return t}function g(t,e){return t?p(t)&&!t[u]?(t.push(e),t):[t,e]:e}function b(t){return t&&!0===t[n]?t[r]:0}function w(t,e){if(void 0===e&&(e=!1),j(t)){t[d]?t[d](e):L(t,(function(n,r){$(t,r),t["ΔΔ"+n]=void 0,e&&w(r,!0)}));var n=t.ΔMd;if(n){var r=[];m(n.parents,(function(t){r.push(t)}));for(var i=function(e){L(e,(function(n,r){r===t&&($(e,t),e["ΔΔ"+n]=void 0)})),z(e)},o=0,a=r;o<a.length;o++){i(a[o])}}}}function L(t,e){if(j(t)){var n=t.constructor.prototype["ΔDefFactories"];for(var r in n)n.hasOwnProperty(r)&&e(r,t["ΔΔ"+r],n[r])}}function j(t){return!(!t||!0!==t[n])}function I(t){return b(t)%2==1}function x(t){var e,n=t.ΔMd;return n&&(e=n.watchers)?p(e)&&!e[u]?e.length:1:0}var C=function(){var t,e,n=[],r=[],i={getDefaultConversion:function(){return o(t,i)},getPreviousConversion:function(){return t.ΔtoJsResult}};function o(t,n){var r=n.getPreviousConversion();if(r)return r;var i=void 0;if(t.Δconvert)i=t.Δconvert(e);else{if(t["Δjson"])return t["Δjson"];i={},L(t,(function(t,n){j(n)&&(n=a(n,e)),void 0!==n&&(i[t]=n)}))}return i}function a(a,s){var u=0===n.length,c=a;if(a&&j(a)&&(n.push(a),c=void 0,r.push(a),t=a,s?(e=s,c=s(a,i)):c=o(a,i),a.ΔtoJsResult=c,r.pop(),t=r[r.length-1]),u){for(var f=n.length;f--;)n[f]["ΔtoJsResult"]=void 0;t=null,n=[],e=void 0}return c}return a}();function E(t,e){var n,r;e&&L(t,(function(i,o,a){var s=a===V;if(n=e[i],r="ΔΔ"+i,void 0===n)s&&(t[r]=void 0);else{var u=typeof n;if(null===n)(s||a===R)&&(t[r]=null);else if("object"===u){var c=function(t,e){if(t&&void 0!==e){if(t[f])return t[f](e);l=!0;var n=t[e];return l=!1,n}}(t,i);c?c[v]=n:s&&(t[r]=n)}else"string"===u?(s||a===M)&&(t[r]=n):"number"===u?(s||a===B)&&(t[r]=n):"boolean"===u?(s||a===D)&&(t[r]=n):s&&(t[r]=n)}}));t[v]=void 0}function N(t){var e=t.prototype;e[n]=!0,e[r]=0}function P(t,e){return t||(t=O,e=3),function(n,r){var i="ΔΔ"+r,a=n[o];a||(a=n[o]={}),a[r]=e?1===e?O:A:t,n[i]=void 0,function(t,e,n,r){r&&delete t[e]&&Object.defineProperty(t,e,r)}(n,r,0,{get:function(){return function(t,e,n,r,i){t.ΔComputeDependencies&&(t.ΔComputeDependencies[n]=!0);!l&&t[v]&&E(t,t[v]);var o=t[e];(void 0===o||l&&null===o)&&(o=t[e]=!l&&i?i>1?void 0:null:r(),_(t,o));return o}(this,i,r,t,e)},set:function(e){J(this,r,i,e,t,this)},enumerable:!0,configurable:!0})}}function S(t){var e=t.ΔFactory;if(e)return e;function n(){return new t}return n[a]=!0,t[i]=n,n}function k(){return""}k[a]=!0;var M=k;function F(){return 0}F[a]=!0;var B=F;function T(){return!1}T[a]=!0;var D=T;function O(){return null}O[a]=!0;var R=O;function A(){}A[a]=!0;var V=A;function J(t,e,n,r,i,o){var a=j(r),s=i===V;if(!t.ΔComputeDependencies){r&&!a&&i.ΔCreateProxy&&(a=j(r=i.ΔCreateProxy(r)||r));var u=!1,c=o[n];return I(t)?u=c!==r:c!==r&&(z(t),u=!0),u&&(a&&void 0===r&&(r=null),(a||c&&j(c))&&function(t,e,n,r){$(t,e),r||_(t,n)}(t,c,r,s),o[n]=r,H(t,"set",e,c,r)),r}console.error("[Trax] @computed properties must not mutate the Data object when calculated")}function H(t,e,n,r,i){var o=t?t.ΔMd:void 0;if(o&&o.trackers){var a=t[s]||t;m(o.trackers,(function(t){t(a,e,n,r,i)}))}}function z(t){if(j(t)){var e=!0;if(I(t)?e=!1:t.ΔChangeVersion+=1,Q.register(t),e){var n=t.ΔMd;n&&n.parents&&m(n.parents,(function(t){z(t)}))}}}function $(t,e){if(e){var n=e.ΔMd;n&&n.parents&&(n.parents=y(n.parents,t))}}function _(t,e){if(e){var n=h(e);n&&(n.parents=g(n.parents,t))}}var q=0,G=function(){function t(){this.id=++q}return t.prototype.register=function(t){var e=this,n=h(t);n&&!n.refreshCtxt&&(this.objects?this.objects.push(t):(this.objects=[t],Promise.resolve().then((function(){e.refresh()}))),n.refreshCtxt=this)},t.prototype.refresh=function(t){void 0===t&&(t=!0);var e=this.objects,n=e?e.length:0;if(n){U();for(var r,i,o=[],a=0;n>a;a++)(i=(r=e[a]).ΔMd).refreshCtxt&&(r.ΔChangeVersion%2&&(r.ΔChangeVersion+=1),i.refreshCtxt&&i.watchers&&o.push({dataNode:r,watchers:i.watchers})),i.refreshCtxt=void 0;this.objects=void 0,o.length&&(t?K(o):Promise.resolve().then((function(){K(o)})))}},t}();function K(t){for(var e=function(t){m(t.watchers,(function(e){e(t.dataNode)}))},n=0,r=t;n<r.length;n++){e(r[n])}}var Q=new G;function U(){Q.objects&&(Q=new G)}var W=["push","pop","shift","unshift","splice"],X=/^\d+$/,Y=/^\Δ/,Z=function(){function t(t){this.ΔTrackable=!0,this.ΔDataFactory=!0,this.ΔChangeVersion=0,this.ΔMd=void 0,this.ΔΔSelf=this,this.ΔIsProxy=!1,this.ΔItemFactory=t}return t.ΔNewProxy=function(e){var n=new Proxy([],new t(e));return n[s]=n,n},t.ΔCreateProxy=function(e,n){if(p(e)){var r=new Proxy(e,new t(n)),i=e.length;for(z(r);i--;)_(r,e[i]);return r}return null},t.prototype.ΔnewItem=function(t){var e=this.ΔItemFactory();return void 0===t&&(t=this.ΔΔList.length),t>-1&&J(this.ΔΔSelf,t,t,e,this.ΔItemFactory,this.ΔΔList),e},t.prototype.Δdispose=function(t){void 0===t&&(t=!1);for(var e,n=this.ΔΔList,r=n.length;r--;)e=n[r],$(this.ΔΔSelf,e),n[r]=void 0,t&&w(e,!0);return n},t.prototype.Δconvert=function(t){for(var e=[],n=this.ΔΔList,r=n.length;r--;)e[r]=C(n[r],t);return e},t.prototype.ΔToString=function(){return"Trax List ["+this.ΔΔList.join(", ")+"]"},t.prototype.ΔinitFromJson=function(){var t=this["Δjson"];if(t){if(t.constructor!==Array)console.error("[Trax] Invalid json type: Lists can only be initialized from Arrays");else for(var e=t.length,n=void 0,r=this.ΔΔList,i=void 0;e--;)if(i=n=t[e],n){var o=this.ΔItemFactory();j(o)&&(o["Δjson"]=n,i=o),r[e]=i}else null===n&&(r[e]=null);this["Δjson"]=void 0}},t.prototype.set=function(t,e,n){if(this.ΔΔList||(this.ΔΔList=t),e.match(X)){var r=parseInt(e,10);J(this.ΔΔSelf,r,r,n,this.ΔItemFactory,this.ΔΔList)}else e.match(Y)&&(this[e]=n);return!0},t.prototype.get=function(t,e){if(this.ΔΔList||(this.ΔΔList=t),e===u)return!0;var n=typeof e;if(this["Δjson"]&&this.ΔinitFromJson(),"string"===n){if(e.match(Y))return this[e];if(e.match(X))return this.ΔΔList[parseInt(e,10)];if("length"===e)return this.ΔΔList.length;if("push"===e)return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=this,i=e.length,o=r.ΔΔList.length,a=0;i>a;a++)r.set(t,o+a+"",e[a])};if("toString"===e)return this.ΔToString;if("function"==typeof t[e])return function(){var t=this,n=W.indexOf(e)>-1;if(n){z(t);for(var r=t.ΔΔList,i=0;r.length>i;i++)$(t,r[i])}var o=t.ΔΔList,a=o[e].apply(o,arguments);if(n){for(r=t.ΔΔList,i=0;r.length>i;i++)_(t,r[i]);H(this,e)}return a}}return e===Symbol.iterator?this.ΔΔList[Symbol.iterator]:this[e]},t}();var tt=function(t){function e(){return Z.ΔNewProxy(t)}return t=t||R,e[a]=!0,e[c]=function(e){return Z.ΔCreateProxy(e,t)},e},et=function(){function n(){}return t([P(M),e("design:type",String)],n.prototype,"firstName",void 0),t([P(M),e("design:type",String)],n.prototype,"lastName",void 0),t([P(B),e("design:type",Number)],n.prototype,"id",void 0),n=t([N],n)}(),nt=function(){function n(){}return t([P(S(et)),e("design:type",et)],n.prototype,"leader",void 0),t([P(M),e("design:type",String)],n.prototype,"name",void 0),t([P(tt(S(et))),e("design:type",Array)],n.prototype,"members",void 0),t([P(),e("design:type",Object)],n.prototype,"data",void 0),n=t([N],n)}(),rt=new et;rt.firstName="Marge",rt.lastName="Simpson",rt.id=1;var it=new et;it.firstName="Homer",it.lastName="Simpson",it.id=1;var ot=new nt;ot.name="The Simpsons",ot.leader=rt,ot.members[0]=rt,ot.members.push(it),ot.data={value1:"v1",value2:"v2"},ct("init complete (watch not activated)"),ft();var at=0;document.getElementById("update1").addEventListener("click",(function(){rt.firstName+="+"+ ++at})),document.getElementById("update2").addEventListener("click",(function(){it.firstName+="+"+ ++at,it.lastName+="+"+at})),document.getElementById("update3").addEventListener("click",(function(){ot.data.value1+="+"+ ++at})),document.getElementById("add").addEventListener("click",(function(){var t=new et;t.firstName="Bart"+ ++at,t.lastName="Simpson",t.id=at,ot.members.push(t)})),document.getElementById("remove").addEventListener("click",(function(){ot.members.splice(0,1)})),document.getElementById("new_data").addEventListener("click",(function(){ot.data={value1:"VAL1-"+ ++at,value2:"VAL2-"+at}})),document.getElementById("reload").addEventListener("click",(function(){location.reload()}));var st,ut=null;function ct(t){(st=st||[]).push(t),document.getElementById("logs").innerHTML=["<b>logs:</b> <br/>",st.join("<br/>")].join("")}function ft(){document.getElementById("data").innerHTML=['<div class="group">',"<div><b>name:</b> ",ot.name,"</div>","<div><b>leader:</b> ",ot.leader.firstName," / ",ot.leader.lastName,"</div>","<div><b>number of members:</b> ",ot.members.length,"</div>","<div><b>members:</b></div>",ot.members.map((function(t,e){return'\n            <div class="member"> \n            '+(e+1)+". "+t.firstName+" / "+t.lastName+"\n            </div>"})).join(""),"<div><b>data:</b> ",JSON.stringify(ot.data),"</div>","</div>"].join("")}document.getElementById("watch").addEventListener("click",(function(){var t,e,n;0===x(ot)?(e=function(){ct("group changed - versions: \n                g="+b(ot)+" \n                user1="+b(rt)+" \n                user2="+b(it)),ft()},n=h(t=ot),ut=n&&e?(n.watchers=g(n.watchers,e),I(t)&&Q.register(t),e):null,ct("group watch <b>activated</b>")):ct("group watch <b>already activated</b>")})),document.getElementById("unwatch").addEventListener("click",(function(){var t,e,n;e=ut,(n=(t=ot)?t.ΔMd:void 0)&&e&&(n.watchers=y(n.watchers,e)),ct("group watch <b>deactivated</b>")}))}();
