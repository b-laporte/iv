!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function t(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function e(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var n="ΔTrackable",r="ΔChangeVersion",i="ΔDefFactories",o="ΔΔProxy",a="ΔIsProxy",c="ΔnewItem",u="Δjson",s=!1;function f(t){return t&&t.ΔTrackable?t.ΔMd?t.ΔMd:t.ΔMd={parents:void 0,refreshCtxt:void 0,watchers:void 0}:null}var d=Array.isArray;function v(t,e){t&&(d(t)&&!t[a]?t.forEach(e):e(t))}function l(t,e){if(t&&e){if(t===e)return;if(d(t)){var n=t;if(1===n.length){if(n[0]===e)return}else{var r=n.indexOf(e);if(r>-1)return n.splice(r,1),1===n.length?n[0]:n}}}return t}function h(t,e){return t?d(t)&&!t[a]?(t.push(e),t):[t,e]:e}function p(t){return t&&!0===t[n]?t[r]:0}function b(t){return!(!t||!0!==t[n])}function y(t){return p(t)%2==1}function g(t){var e,n=t.ΔMd;return n&&(e=n.watchers)?d(e)&&!e[a]?e.length:1:0}function m(t,e){var n,r;e&&function(t,e){if(b(t)){var n=t.constructor.prototype["ΔDefFactories"];for(var r in n)n.hasOwnProperty(r)&&e(r,t["ΔΔ"+r],n[r])}}(t,(function(i,o,a){var f=a===F;if(n=e[i],r="ΔΔ"+i,void 0===n)f&&(t[r]=void 0);else{var d=typeof n;if(null===n)(f||a===k)&&(t[r]=null);else if("object"===d){var v=function(t,e){if(t&&void 0!==e){if(t[c])return t[c](e);s=!0;var n=t[e];return s=!1,n}}(t,i);v?v[u]=n:f&&(t[r]=n)}else"string"===d?(f||a===x)&&(t[r]=n):"number"===d?(f||a===M)&&(t[r]=n):"boolean"===d?(f||a===P)&&(t[r]=n):f&&(t[r]=n)}}));t[u]=void 0}function w(t){var e=t.prototype;e[n]=!0,e[r]=0}function j(t,e){return t||(t=E,e=3),function(n,r){var a="ΔΔ"+r,c=n[i];c||(c=n[i]={}),c[r]=e?1===e?E:D:t,n[a]=void 0,function(t,e,n,r){r&&delete t[e]&&Object.defineProperty(t,e,r)}(n,r,0,{get:function(){return function(t,e,n,r,i){t.ΔComputeDependencies&&(t.ΔComputeDependencies[n]=!0);!s&&t[u]&&m(t,t[u]);var o=t[e];(void 0===o||s&&null===o)&&(o=t[e]=!s&&i?i>1?void 0:null:r(),O(t,o));return o}(this,a,r,t,e)},set:function(e){!function(t,e,n,r,i,a){var c=b(r),u=i===F;if(t.ΔComputeDependencies)return void console.error("[Trax] @computed properties must not mutate the Data object when calculated");r&&!c&&i.ΔCreateProxy&&(r=i.ΔCreateProxy(r)||r,c=b(r));var s=!1,f=a[n];y(t)?s=f!==r:f!==r&&(!function t(e){if(!b(e))return;var n=!0;y(e)?n=!1:e.ΔChangeVersion+=1;if(T.register(e),n){var r=e.ΔMd;r&&r.parents&&v(r.parents,(function(e){t(e)}))}}(t),s=!0);s&&(c&&void 0===r&&(r=null),(c||f&&b(f))&&function(t,e,n,r){(function(t,e){if(e){var n=e.ΔMd;n&&n.parents&&(n.parents=l(n.parents,t))}})(t,e),r||O(t,n)}(t,f,r,u),a[n]=r,function(t,e,n,r,i){var a=t?t.ΔMd:void 0;if(a&&a.trackers){var c=t[o]||t;v(a.trackers,(function(t){t(c,e,n,r,i)}))}}(t,"set",e,f,r))}(this,r,a,e,t,this)},enumerable:!0,configurable:!0})}}function C(){return""}C["ΔIsFactory"]=!0;var x=C;function I(){return 0}I["ΔIsFactory"]=!0;var M=I;function N(){return!1}N["ΔIsFactory"]=!0;var P=N;function E(){return null}E["ΔIsFactory"]=!0;var k=E;function D(){}D["ΔIsFactory"]=!0;var F=D;function O(t,e){if(e){var n=f(e);n&&(n.parents=h(n.parents,t))}}var R=0,B=function(){function t(){this.id=++R}return t.prototype.register=function(t){var e=this,n=f(t);n&&!n.refreshCtxt&&(this.objects?this.objects.push(t):(this.objects=[t],Promise.resolve().then((function(){e.refresh()}))),n.refreshCtxt=this)},t.prototype.refresh=function(t){void 0===t&&(t=!0);var e=this.objects,n=e?e.length:0;if(n){V();for(var r,i,o=[],a=0;n>a;a++)(i=(r=e[a]).ΔMd).refreshCtxt&&(r.ΔChangeVersion%2&&(r.ΔChangeVersion+=1),i.refreshCtxt&&i.watchers&&o.push({dataNode:r,watchers:i.watchers})),i.refreshCtxt=void 0;this.objects=void 0,o.length&&(t?L(o):Promise.resolve().then((function(){L(o)})))}},t}();function L(t){for(var e=function(t){v(t.watchers,(function(e){e(t.dataNode)}))},n=0,r=t;n<r.length;n++){e(r[n])}}var T=new B;function V(){T.objects&&(T=new B)}var S=new(function(){function n(){}return t([j(x),e("design:type",String)],n.prototype,"firstName",void 0),t([j(x),e("design:type",String)],n.prototype,"lastName",void 0),t([j(M),e("design:type",Number)],n.prototype,"id",void 0),n=t([w],n)}());S.firstName="Marge",S.lastName="Simpson",S.id=1,z("init complete (watch not activated)"),G();var A=0;document.getElementById("update-btn").addEventListener("click",(function(){S.firstName+="+"+ ++A,S.id++}));var H,q=null;function z(t){var e=(H=H||[]).length+1;H.push("<b>"+e+". </b>"+t),document.getElementById("logs").innerHTML=["<b>logs:</b> <br/>",H.join(", ")].join("")}function G(){document.getElementById("data").innerHTML=['<div class="user"> <b>user:</b> ',S.firstName," / ",S.lastName," / ",S.id,"</div>"].join("")}document.getElementById("watch-btn").addEventListener("click",(function(){var t,e,n;0===g(S)?(e=function(){z("user changed - version: "+p(S)),G()},n=f(t=S),q=n&&e?(n.watchers=h(n.watchers,e),y(t)&&T.register(t),e):null,z("watch <b>activated</b>")):z("watch <b>already activated</b>")})),document.getElementById("unwatch-btn").addEventListener("click",(function(){var t,e,n;e=q,(n=(t=S)?t.ΔMd:void 0)&&e&&(n.watchers=l(n.watchers,e)),z("watch <b>deactivated</b>")}))}();
