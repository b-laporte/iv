!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function t(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var n="ΔTrackable",r="ΔChangeVersion",o="ΔDefFactories",i="ΔΔProxy",a="ΔIsProxy",c="ΔnewItem",u="Δjson",s=!1;function f(e){return e&&e.ΔTrackable?e.ΔMd?e.ΔMd:e.ΔMd={parents:void 0,refreshCtxt:void 0,watchers:void 0}:null}var d=Array.isArray;function v(e,t){e&&(d(e)&&!e[a]?e.forEach(t):t(e))}function l(e,t){if(e&&t){if(e===t)return;if(d(e)){var n=e;if(1===n.length){if(n[0]===t)return}else{var r=n.indexOf(t);if(r>-1)return n.splice(r,1),1===n.length?n[0]:n}}}return e}function h(e,t){return e?d(e)&&!e[a]?(e.push(t),e):[e,t]:t}function p(e){return e&&!0===e[n]?e[r]:0}function y(e){return!(!e||!0!==e[n])}function m(e){return p(e)%2==1}function g(e){var t,n=e.ΔMd;return n&&(t=n.watchers)?d(t)&&!t[a]?t.length:1:0}function b(e,t){var n,r;t&&function(e,t){if(y(e)){var n=e.constructor.prototype["ΔDefFactories"];for(var r in n)n.hasOwnProperty(r)&&t(r,e["ΔΔ"+r],n[r])}}(e,(function(o,i,a){var f=a===F;if(n=t[o],r="ΔΔ"+o,void 0===n)f&&(e[r]=void 0);else{var d=typeof n;if(null===n)(f||a===k)&&(e[r]=null);else if("object"===d){var v=function(e,t){if(e&&void 0!==t){if(e[c])return e[c](t);s=!0;var n=e[t];return s=!1,n}}(e,o);v?v[u]=n:f&&(e[r]=n)}else"string"===d?(f||a===I)&&(e[r]=n):"number"===d?(f||a===M)&&(e[r]=n):"boolean"===d?(f||a===N)&&(e[r]=n):f&&(e[r]=n)}}));e[u]=void 0}function w(e){var t=e.prototype;t[n]=!0,t[r]=0}function j(e,t){return e||(e=P,t=3),function(n,r){var a="ΔΔ"+r,c=n[o];c||(c=n[o]={}),c[r]=t?1===t?P:D:e,n[a]=void 0,function(e,t,n,r){r&&delete e[t]&&Object.defineProperty(e,t,r)}(n,r,0,{get:function(){return function(e,t,n,r,o){e.ΔComputeDependencies&&(e.ΔComputeDependencies[n]=!0);!s&&e[u]&&b(e,e[u]);var i=e[t];(void 0===i||s&&null===i)&&(i=e[t]=!s&&o?o>1?void 0:null:r(),B(e,i));return i}(this,a,r,e,t)},set:function(t){!function(e,t,n,r,o,a){var c=y(r),u=o===F;if(e.ΔComputeDependencies)return void console.error("[Trax] @computed properties must not mutate the Data object when calculated");r&&!c&&o.ΔCreateProxy&&(r=o.ΔCreateProxy(r)||r,c=y(r));var s=!1,f=a[n];m(e)?s=f!==r:f!==r&&(!function e(t){if(!y(t))return;var n=!0;m(t)?n=!1:t.ΔChangeVersion+=1;if(T.register(t),n){var r=t.ΔMd;r&&r.parents&&v(r.parents,(function(t){e(t)}))}}(e),s=!0);s&&(c&&void 0===r&&(r=null),(c||f&&y(f))&&function(e,t,n,r){(function(e,t){if(t){var n=t.ΔMd;n&&n.parents&&(n.parents=l(n.parents,e))}})(e,t),r||B(e,n)}(e,f,r,u),a[n]=r,function(e,t,n,r,o){var a=e?e.ΔMd:void 0;if(a&&a.trackers){var c=e[i]||e;v(a.trackers,(function(e){e(c,t,n,r,o)}))}}(e,"set",t,f,r))}(this,r,a,t,e,this)},enumerable:!0,configurable:!0})}}function C(){return""}C["ΔIsFactory"]=!0;var I=C;function x(){return 0}x["ΔIsFactory"]=!0;var M=x;function E(){return!1}E["ΔIsFactory"]=!0;var N=E;function P(){return null}P["ΔIsFactory"]=!0;var k=P;function D(){}D["ΔIsFactory"]=!0;var F=D;function B(e,t){if(t){var n=f(t);n&&(n.parents=h(n.parents,e))}}var L=0,O=function(){function e(){this.id=++L}return e.prototype.register=function(e){var t=this,n=f(e);n&&!n.refreshCtxt&&(this.objects?this.objects.push(e):(this.objects=[e],Promise.resolve().then((function(){t.refresh()}))),n.refreshCtxt=this)},e.prototype.refresh=function(e){void 0===e&&(e=!0);var t=this.objects,n=t?t.length:0;if(n){V();for(var r,o,i=[],a=0;n>a;a++)(o=(r=t[a]).ΔMd).refreshCtxt&&(r.ΔChangeVersion%2&&(r.ΔChangeVersion+=1),o.refreshCtxt&&o.watchers&&i.push({dataNode:r,watchers:o.watchers})),o.refreshCtxt=void 0;this.objects=void 0,i.length&&(e?R(i):Promise.resolve().then((function(){R(i)})))}},e}();function R(e){for(var t=function(e){v(e.watchers,(function(t){t(e.dataNode)}))},n=0,r=e;n<r.length;n++){t(r[n])}}var T=new O;function V(){T.objects&&(T=new O)}var S=new(function(){function n(){}return e([j(I),t("design:type",String)],n.prototype,"firstName",void 0),e([j(I),t("design:type",String)],n.prototype,"lastName",void 0),e([j(M),t("design:type",Number)],n.prototype,"id",void 0),n=e([w],n)}());S.firstName="Marge",S.lastName="Simpson",S.id=1,z("init complete (watch not activated)"),G();var A=0;document.getElementById("update").addEventListener("click",(function(){S.firstName+="+"+ ++A,S.id++}));var H,q=null;function z(e){(H=H||[]).push(e),document.getElementById("logs").innerHTML=["<b>logs:</b> <br/>",H.join("<br/>")].join("")}function G(){document.getElementById("data").innerHTML=['<div class="user"> <b>user:</b> ',S.firstName," / ",S.lastName," / ",S.id,"</div>"].join("")}document.getElementById("watch").addEventListener("click",(function(){var e,t,n;0===g(S)?(t=function(){z("user changed - version: "+p(S)),G()},n=f(e=S),q=n&&t?(n.watchers=h(n.watchers,t),m(e)&&T.register(e),t):null,z("watch <b>activated</b>")):z("watch <b>already activated</b>")})),document.getElementById("unwatch").addEventListener("click",(function(){var e,t,n;t=q,(n=(e=S)?e.ΔMd:void 0)&&t&&(n.watchers=l(n.watchers,t)),z("watch <b>deactivated</b>")})),document.getElementById("reload").addEventListener("click",(function(){location.reload()}))}();
